# Тестировка

## Проект: «Карта добрых дел Росатома» (404: Sleep Not Found)

**Версия проекта:** 2.0  
**Дата проведения испытаний:** 28.11.2025  
**Место проведения:** ВИТИ НИЯУ МИФИ  

---

## 1. ОБЩИЕ СВЕДЕНИЯ

### 1.1 Цель испытаний
Проверка соответствия разработанной системы техническому заданию и требованиям заказчика, подтверждение готовности к промышленной эксплуатации.

### 1.2 Объект испытаний
Интерактивная веб-платформа для отображения и управления НКО на карте с дополнительным функционалом.

---

## 2. ТЕХНИЧЕСКАЯ КОНФИГУРАЦИЯ

### 2.1 Серверное окружение
```
ОС: Ubuntu 20.04 LTS / Debian 11
Web-сервер: Nginx 1.18+
PHP: 8.1+ (с расширениями: mysqli, curl, mbstring, xml, gd, zip)
СУБД: MySQL 8.0+
```

### 2.2 Клиентская часть
```
Браузеры: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
Разрешения экрана: 1920x1080 (desktop), 768x1024 (tablet), 375x667 (mobile)
JavaScript: ES6+
```

### 2.3 Интеграции
- Yandex Maps JavaScript API v2.1
- PHPMailer 6.x (SMTP: smtp.yandex.com:465)
- PapaParse 5.4.1

---

## 3. ФУНКЦИОНАЛЬНЫЕ ИСПЫТАНИЯ

### 3.1 Модуль аутентификации и авторизации

#### Тест 3.1.1: Регистрация пользователя
**Цель:** Проверка создания нового аккаунта с email-подтверждением

| Шаг | Действие | Ожидаемый результат | Статус |
|-----|----------|---------------------|--------|
| 1 | Открыть форму регистрации | Форма отображается корректно | ✅ PASS |
| 2 | Заполнить поля: Имя (рус), Фамилия (рус), Email, Пароль (6+ символов) | Валидация работает | ✅ PASS |
| 3 | Отправить форму | Письмо с 4-значным кодом отправлено на email | ✅ PASS |
| 4 | Ввести код подтверждения | Регистрация завершена, пользователь создан в БД | ✅ PASS |
| 5 | Проверить запись в таблице `users` | Пароль захеширован, роль `user` назначена | ✅ PASS |

**Примечание:** PHPMailer использует Yandex SMTP (rohanudzumaki@yandex.ru). Письма приходят в течение 5-10 секунд.

#### Тест 3.1.2: Вход в систему
| Шаг | Действие | Ожидаемый результат | Статус |
|-----|----------|---------------------|--------|
| 1 | Ввести корректные логин/пароль | Вход выполнен, установлена кука `auth_key` | ✅ PASS |
| 2 | Проверить опцию "Запомнить меня" | Кука устанавливается на 30 дней | ✅ PASS |
| 3 | Ввести неверный пароль | Ошибка: "Неверный пароль!" | ✅ PASS |
| 4 | Попытка входа с несуществующим логином | Ошибка: "Пользователь не найден!" | ✅ PASS |

#### Тест 3.1.3: Восстановление пароля
| Шаг | Действие | Ожидаемый результат | Статус |
|-----|----------|---------------------|--------|
| 1 | Нажать "Забыли пароль?" | Форма восстановления открывается | ✅ PASS |
| 2 | Ввести зарегистрированный email | Письмо со ссылкой отправлено | ✅ PASS |
| 3 | Перейти по ссылке из письма | Форма смены пароля доступна (токен действителен 1 час) | ✅ PASS |
| 4 | Установить новый пароль | Пароль обновлен, токен удален из таблицы `password_resets` | ✅ PASS |

---

### 3.2 Модуль интерактивной карты

#### Тест 3.2.1: Отображение объектов на карте
**Цель:** Проверка корректности загрузки и визуализации городов и НКО

| Шаг | Действие | Ожидаемый результат | Статус |
|-----|----------|---------------------|--------|
| 1 | Открыть главную страницу, прокрутить до карты | Карта загружается (Yandex Maps) | ✅ PASS |
| 2 | Проверить отображение городов Росатома (32 города) | Синие метки `islands#blueCircleIcon` | ✅ PASS |
| 3 | Проверить отображение НКО (22 организации) | Цветные метки по типам (желтые, зеленые, оранжевые и т.д.) | ✅ PASS |
| 4 | Кликнуть на метку | Балун открывается с данными: название, тип, город, краткое описание | ✅ PASS |
| 5 | Нажать "Подробнее" в балуне | Модальное окно с полной информацией (описание, контакты, соцсети) | ✅ PASS |

#### Тест 3.2.2: Фильтрация и поиск
| Шаг | Действие | Ожидаемый результат | Статус |
|-----|----------|---------------------|--------|
| 1 | Открыть боковую панель фильтров | 8 типов фильтров (города, социальная защита, экология и т.д.) | ✅ PASS |
| 2 | Выбрать тип "Экология и устойчивое развитие" | Показаны только зеленые метки НКО экологии | ✅ PASS |
| 3 | Раскрыть фильтр "Города Росатома" | Выпадающий список с 32 городами | ✅ PASS |
| 4 | Выбрать "Волгодонск" | Показаны город + НКО в Волгодонске | ✅ PASS |
| 5 | Ввести "Зеленогорск" в поиск по карте | Карта центрируется, открывается балун | ✅ PASS |
| 6 | Поиск по названию НКО "Экологический союз" | Найдена НКО в Железногорске | ✅ PASS |

#### Тест 3.2.3: Кластеризация меток
| Шаг | Действие | Ожидаемый результат | Статус |
|-----|----------|---------------------|--------|
| 1 | Уменьшить масштаб карты (zoom < 8) | Близкие метки объединяются в кластеры | ✅ PASS |
| 2 | Кликнуть на кластер | Балун кластера с каруселью объектов | ✅ PASS |
| 3 | Нажать "Подробнее" в элементе кластера | Модальное окно открывается корректно | ✅ PASS |

#### Тест 3.2.4: Полноэкранный режим
| Шаг | Действие | Ожидаемый результат | Статус |
|-----|----------|---------------------|--------|
| 1 | Нажать кнопку "Полный экран" | Карта разворачивается на весь экран, боковая панель скрывается | ✅ PASS |
| 2 | Нажать ESC | Выход из полноэкранного режима | ✅ PASS |

---

### 3.3 Модуль управления проектами

#### Тест 3.3.1: Просмотр проектов
| Шаг | Действие | Ожидаемый результат | Статус |
|-----|----------|---------------------|--------|
| 1 | Прокрутить до секции "Актуальные проекты" | Отображено 6 карточек (пагинация) | ✅ PASS |
| 2 | Проверить карточку проекта | Отображены: тип, название, локация, описание, участники, дата, НКО | ✅ PASS |
| 3 | Кликнуть на ссылку НКО | Открывается сайт/соцсети НКО в новой вкладке | ✅ PASS |
| 4 | Переключить страницу пагинации | AJAX-загрузка следующих 6 проектов без перезагрузки | ✅ PASS |

#### Тест 3.3.2: Поиск проектов
| Шаг | Действие | Ожидаемый результат | Статус |
|-----|----------|---------------------|--------|
| 1 | Ввести "экология" в строку поиска | Найдены проекты с типом "Экология" | ✅ PASS |
| 2 | Поиск "Волгодонск" | Проекты из Волгодонска | ✅ PASS |
| 3 | Применить фильтры (Социальные проекты + Волонтерство) | Результаты по двум критериям | ✅ PASS |
| 4 | Нажать "Вернуться ко всем проектам" | Сброс фильтров, показ всех проектов | ✅ PASS |

#### Тест 3.3.3: Участие в проекте (авторизованный пользователь)
| Шаг | Действие | Ожидаемый результат | Статус |
|-----|----------|---------------------|--------|
| 1 | Войти как пользователь (не НКО, не админ) | Кнопка "Помочь" доступна | ✅ PASS |
| 2 | Нажать "Помочь" на проекте | Кнопка меняется на "Вы участвуете" (disabled) | ✅ PASS |
| 3 | Проверить `card_participants` | Запись создана: `user_id`, `card_id`, `joined_at` | ✅ PASS |
| 4 | Проверить счетчик участников | `current_participants` увеличился на 1 | ✅ PASS |
| 5 | Проверить email создателя проекта | Письмо отправлено с данными волонтера | ✅ PASS |

**Email уведомление:** PHPMailer отправляет HTML-письмо создателю проекта с информацией о новом участнике.

#### Тест 3.3.4: Создание проекта (НКО)
| Шаг | Действие | Ожидаемый результат | Статус |
|-----|----------|---------------------|--------|
| 1 | Войти как НКО (роль `nko`, статус `approved`) | Кнопка "Добавить свой проект" видна | ✅ PASS |
| 2 | Заполнить форму: тип, заголовок, локация, описание, дата, макс. участники | Валидация обязательных полей | ✅ PASS |
| 3 | Отправить форму | Проект создан, `created_by = user_id` НКО | ✅ PASS |
| 4 | Проверить отображение на главной | Новый проект в списке с названием НКО | ✅ PASS |

#### Тест 3.3.5: Удаление проекта
| Шаг | Действие | Ожидаемый результат | Статус |
|-----|----------|---------------------|--------|
| 1 | НКО/Админ видит кнопку "×" на своих проектах | Кнопка удаления отображается | ✅ PASS |
| 2 | Нажать "×", подтвердить удаление | Проект удален из БД + каскадное удаление участников | ✅ PASS |
| 3 | Попытка удаления чужого проекта (не админ) | Ошибка: "Недостаточно прав" | ✅ PASS |

---

### 3.4 Модуль управления НКО

#### Тест 3.4.1: Регистрация НКО (пользователь)
| Шаг | Действие | Ожидаемый результат | Статус |
|-----|----------|---------------------|--------|
| 1 | Войти как обычный пользователь, открыть профиль | Секция "Информация об НКО" скрыта | ✅ PASS |
| 2 | Раскрыть секцию НКО, заполнить обязательные поля | Название, категория, описание, функционал волонтеров | ✅ PASS |
| 3 | Загрузить логотип (PNG/JPG, 200x200px) | Файл загружается в `uploads/logos/` | ✅ PASS |
| 4 | Сохранить данные | Запись в `nko_organizations` со статусом `pending` | ✅ PASS |
| 5 | Проверить интерфейс | Бейдж "На модерации", кнопка "Добавить проект" недоступна | ✅ PASS |

#### Тест 3.4.2: Модерация НКО (администратор)
| Шаг | Действие | Ожидаемый результат | Статус |
|-----|----------|---------------------|--------|
| 1 | Войти как `admin`, открыть Админ-панель | Вкладка "Заявки НКО" доступна | ✅ PASS |
| 2 | Просмотреть заявки со статусом `pending` | Таблица с данными НКО, кнопки "Одобрить"/"Отклонить" | ✅ PASS |
| 3 | Нажать "Подробнее" | Модальное окно со всей информацией (логотип, контакты, описание) | ✅ PASS |
| 4 | Нажать "Одобрить" | Статус → `approved`, роль `nko` назначена пользователю | ✅ PASS |
| 5 | Проверить `user_roles` | Запись `user_id` + `role_id=2 (nko)` создана | ✅ PASS |
| 6 | Нажать "Отклонить", ввести причину | Статус → `rejected`, комментарий сохранен | ✅ PASS |

#### Тест 3.4.3: Повторная отправка заявки (после отклонения)
| Шаг | Действие | Ожидаемый результат | Статус |
|-----|----------|---------------------|--------|
| 1 | Пользователь видит "Заявка отклонена" + комментарий модератора | Отображается подсказка с причиной | ✅ PASS |
| 2 | Исправить данные, нажать "Отправить заявку повторно" | Статус → `pending`, комментарий очищен | ✅ PASS |
| 3 | Админ видит заявку в списке `pending` | Доступна повторная модерация | ✅ PASS |

---

### 3.5 Административная панель

#### Тест 3.5.1: Управление пользователями
| Шаг | Действие | Ожидаемый результат | Статус |
|-----|----------|---------------------|--------|
| 1 | Войти как `admin`, открыть вкладку "Пользователи" | Таблица всех пользователей с ролями | ✅ PASS |
| 2 | Назначить роль `admin` пользователю | Кнопка "Админ" неактивна после назначения | ✅ PASS |
| 3 | Назначить роль `nko` | Роль добавлена, доступ к созданию проектов | ✅ PASS |
| 4 | Удалить пользователя (не текущий) | Каскадное удаление: user → user_roles → card_participants | ✅ PASS |
| 5 | Попытка удалить себя | Ошибка: "Нельзя удалить свой аккаунт" | ✅ PASS |

#### Тест 3.5.2: Управление городами и НКО на карте
| Шаг | Действие | Ожидаемый результат | Статус |
|-----|----------|---------------------|--------|
| 1 | Открыть вкладку "Города и НКО" | Список 32 городов + 22 НКО | ✅ PASS |
| 2 | Нажать "Добавить объект" → выбрать "Город Росатома" | Форма с полями: название, регион, координаты | ✅ PASS |
| 3 | Ввести координаты (55.7558, 37.6173) | Валидация: -90…90 (lat), -180…180 (lon) | ✅ PASS |
| 4 | Сохранить город | Запись в `rosatom_cities` (`object_type=city`) | ✅ PASS |
| 5 | Нажать "Показать" на городе | Карта центрируется, балун открывается | ✅ PASS |
| 6 | Деактивировать город | `is_active=0`, метка исчезает с карты | ✅ PASS |
| 7 | Удалить город | Запись удалена, метка убрана | ✅ PASS |

#### Тест 3.5.3: Статистика
| Шаг | Действие | Ожидаемый результат | Статус |
|-----|----------|---------------------|--------|
| 1 | Открыть вкладку "Статистика" | Счетчики: города, НКО, проекты, волонтеры | ✅ PASS |
| 2 | Проверить динамическое обновление | Добавить проект → счетчик увеличивается | ✅ PASS |
| 3 | Проверить вычисление волонтеров | `SELECT COUNT(DISTINCT user_id) FROM card_participants` | ✅ PASS |

---

### 3.6 Модуль профиля пользователя

#### Тест 3.6.1: Редактирование профиля
| Шаг | Действие | Ожидаемый результат | Статус |
|-----|----------|---------------------|--------|
| 1 | Открыть профиль | Заполнены: имя, фамилия, email (readonly) | ✅ PASS |
| 2 | Изменить имя и фамилию | Сохранение в БД, сессия обновляется | ✅ PASS |
| 3 | Попытка изменить email | Поле неактивно (защита от смены логина) | ✅ PASS |

#### Тест 3.6.2: Смена пароля
| Шаг | Действие | Ожидаемый результат | Статус |
|-----|----------|---------------------|--------|
| 1 | Нажать "Сменить пароль" | Модальное окно с полем "Текущий пароль" | ✅ PASS |
| 2 | Ввести неверный текущий пароль | Ошибка: "Неверный текущий пароль" | ✅ PASS |
| 3 | Ввести верный текущий пароль | Поля "Новый пароль" и "Подтверждение" открываются | ✅ PASS |
| 4 | Установить новый пароль (6+ символов) | Пароль обновлен, `password_verify()` проходит | ✅ PASS |

#### Тест 3.6.3: Просмотр своих проектов (НКО)
| Шаг | Действие | Ожидаемый результат | Статус |
|-----|----------|---------------------|--------|
| 1 | Открыть профиль НКО | Секция "Мои проекты" со списком карточек | ✅ PASS |
| 2 | Нажать "Просмотреть" на проекте | Переход к секции "Актуальные проекты", проект подсвечен | ✅ PASS |
| 3 | Проверить отсутствие проектов | Сообщение: "У вас пока нет созданных проектов" | ✅ PASS |

---

### 3.7 Версия для слабовидящих

#### Тест 3.7.1: Панель доступности
| Шаг | Действие | Ожидаемый результат | Статус |
|-----|----------|---------------------|--------|
| 1 | Нажать иконку глаза в шапке/футере | Панель доступности открывается | ✅ PASS |
| 2 | Изменить размер текста (A-, A, A+) | Шрифт 16px / 18px / 20px | ✅ PASS |
| 3 | Выбрать "Контрастная" схему | Цвета: черный фон, белый текст | ✅ PASS |
| 4 | Выбрать "Темная" схему | Градиент темный, текст светлый | ✅ PASS |
| 5 | Увеличить межстрочный интервал | `line-height: 1.8` | ✅ PASS |
| 6 | Шрифт "Для дислексии" | `font-family: Comic Sans MS` | ✅ PASS |
| 7 | Нажать "Сбросить настройки" | Все параметры возвращены к умолчанию | ✅ PASS |
| 8 | Закрыть панель (ESC / крестик) | Панель скрывается | ✅ PASS |

---

## 4. НЕФУНКЦИОНАЛЬНЫЕ ИСПЫТАНИЯ

### 4.1 Производительность

#### Тест 4.1.1: Скорость загрузки страницы
| Метрика | Норматив | Фактический результат | Статус |
|---------|----------|----------------------|--------|
| First Contentful Paint (FCP) | < 1.8s | 1.2s | ✅ PASS |
| Largest Contentful Paint (LCP) | < 2.5s | 2.1s | ✅ PASS |
| Time to Interactive (TTI) | < 3.8s | 3.2s | ✅ PASS |
| Total Blocking Time (TBT) | < 300ms | 180ms | ✅ PASS |

#### Тест 4.1.2: AJAX-запросы
| Запрос | Норматив | Фактический результат | Статус |
|--------|----------|----------------------|--------|
| `get_cards_ajax.php` (6 карточек) | < 500ms | 320ms | ✅ PASS |
| `search_projects.php` | < 800ms | 540ms | ✅ PASS |
| `get_cities.php?action=get_all_with_nko` | < 1000ms | 780ms | ✅ PASS |
| `join_project.php` (с email) | < 2000ms | 1650ms | ✅ PASS |

### 4.2 Безопасность

#### Тест 4.2.1: SQL-инъекции
| Поле ввода | Вредоносный ввод | Результат | Статус |
|------------|------------------|-----------|--------|
| Логин | `admin' OR '1'='1` | Prepared statements блокируют | ✅ PASS |
| Поиск проектов | `'; DROP TABLE users;--` | Экранирование работает | ✅ PASS |
| Название НКО | `<script>alert('XSS')</script>` | `htmlspecialchars()` очищает | ✅ PASS |

#### Тест 4.2.2: XSS-атаки
| Поле | Вредоносный ввод | Результат | Статус |
|------|------------------|-----------|--------|
| Описание проекта | `<img src=x onerror=alert(1)>` | Выводится как текст | ✅ PASS |
| Имя пользователя | `<script>document.cookie</script>` | Очищено при выводе | ✅ PASS |

#### Тест 4.2.3: Аутентификация
| Сценарий | Ожидаемый результат | Статус |
|----------|---------------------|--------|
| Доступ к `/php/admin_ajax.php` без куки | HTTP 403 + JSON: "Доступ запрещен" | ✅ PASS |
| Подделка `auth_key` в куке | Запрос отклонен | ✅ PASS |
| Пароли в БД | Хешированы (bcrypt, cost=10) | ✅ PASS |

#### Тест 4.2.4: Загрузка файлов
| Сценарий | Результат | Статус |
|----------|-----------|--------|
| Загрузка PHP-файла как логотипа | Блокировано (проверка MIME-типа) | ✅ PASS |
| Загрузка файла > 5MB | Ошибка: "Размер файла превышает лимит" | ✅ PASS |
| Загрузка JPG/PNG/SVG | Успешно в `uploads/logos/` | ✅ PASS |

### 4.3 Адаптивность

#### Тест 4.3.1: Мобильные устройства
| Разрешение | Элементы | Результат | Статус |
|------------|----------|-----------|--------|
| 375x667 (iPhone SE) | Карточки проектов в 1 колонку | Корректно | ✅ PASS |
| 768x1024 (iPad) | Карточки в 2 колонки | Корректно | ✅ PASS |
| 1920x1080 (Desktop) | Карточки в 3 колонки | Корректно | ✅ PASS |

#### Тест 4.3.2: Карта на мобильных
| Действие | Результат | Статус |
|----------|-----------|--------|
| Свайп по карте | Прокрутка работает | ✅ PASS |
| Pinch-to-zoom | Масштабирование работает | ✅ PASS |
| Боковая панель фильтров | Скрывается на < 768px | ✅ PASS |

### 4.4 Кроссбраузерность

#### Тест 4.4.1: Тестирование в браузерах
| Браузер | Версия | Карта | Формы | AJAX | Статус |
|---------|--------|-------|-------|------|--------|
| Chrome | 120.0 | ✅ | ✅ | ✅ | ✅ PASS |
| Firefox | 121.0 | ✅ | ✅ | ✅ | ✅ PASS |
| Safari | 17.0 | ✅ | ✅ | ✅ | ✅ PASS |
| Edge | 120.0 | ✅ | ✅ | ✅ | ✅ PASS |

## 5 Проверка возможностей хостинга
