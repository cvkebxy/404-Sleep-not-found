(function(){
    const MapModule = { init(){ if(typeof ymaps==='undefined'){ window.addEventListener('load', ()=>{ if(typeof ymaps!=='undefined') this.createMap(); }); } else { this.createMap(); } }, createMap(){ try{ if(typeof ymaps==='undefined') return; ymaps.ready(()=>{ const mapEl=document.getElementById('map'); if(!mapEl) return; const map=new ymaps.Map('map',{ center:[55.76,37.64], zoom:4, controls:['zoomControl'] }); const objectManager=new ymaps.ObjectManager({ clusterize:true, gridSize:64 }); map.geoObjects.add(objectManager); if(typeof Papa!=='undefined'){ Papa.parse('data/nko.csv',{ download:true, header:true, delimiter:';', complete:function(results){ const rows = results.data||[]; const features = rows.map((row,i)=>{ const lat=parseFloat(row['Широта']); const lon=parseFloat(row['Долгота']); const name=(row['Подпись']||'').trim(); if(!lat||!lon||!name) return null; return { type:'Feature', id:i+1, geometry:{type:'Point', coordinates:[lat, lon]}, properties:{ hintContent:name, balloonContent:`<strong>${name}</strong>` } }; }).filter(Boolean); objectManager.add({ type:'FeatureCollection', features }); } }); } }); }catch(e){ console.error('map init error',e); } } };
    window.MapModule = MapModule;
})();
